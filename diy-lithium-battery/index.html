<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>DIY Lithium battery - Part I - twoandahalfvan</title><meta name="description" content="Blog post about building your own 12V Lithium battery. Save you a couple of thousand € when compared to ready-to-buy Lithium batteries."><meta name="robots" content="index, follow"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://twoandahalfvan.github.io/diy-lithium-battery/"><link rel="alternate" type="application/atom+xml" href="https://twoandahalfvan.github.io/feed.xml"><link rel="alternate" type="application/json" href="https://twoandahalfvan.github.io/feed.json"><meta property="og:title" content="DIY Lithium battery - Part I"><meta property="og:image" content="https://twoandahalfvan.github.io/media/posts/18/IMG_7628.JPG"><meta property="og:site_name" content="twoandahalfvan - Vanlife in Europe"><meta property="og:description" content="Blog post about building your own 12V Lithium battery. Save you a couple of thousand € when compared to ready-to-buy Lithium batteries."><meta property="og:url" content="https://twoandahalfvan.github.io/diy-lithium-battery/"><meta property="og:type" content="article"><link rel="shortcut icon" href="https://twoandahalfvan.github.io/media/website/Logo-twoandahalfvan.png" type="image/png"><link rel="apple-touch-icon" href="/media/files/apple-touch-icon.png"><link rel="apple-touch-icon" href="/media/files/apple-touch-icon-57x57.png" sizes="57x57"><link rel="apple-touch-icon" href="/media/files/apple-touch-icon-60x60.png" sizes="60x60"><link rel="apple-touch-icon" href="/media/files/apple-touch-icon-72x72.png" sizes="72x72"><link rel="apple-touch-icon" href="/media/files/apple-touch-icon-76x76.png" sizes="76x76"><link rel="apple-touch-icon" href="/media/files/apple-touch-icon-114x114.png" sizes="114x114"><link rel="apple-touch-icon" href="/media/files/apple-touch-icon-120x120.png" sizes="120x120"><link rel="apple-touch-icon" href="/media/files/apple-touch-icon-128x128.png" sizes="128x128"><link rel="apple-touch-icon" href="/media/files/apple-touch-icon-144x144.png" sizes="144x144"><link rel="apple-touch-icon" href="/media/files/apple-touch-icon-152x152.png" sizes="152x152"><link rel="apple-touch-icon" href="/media/files/apple-touch-icon-180x180.png" sizes="180x180"><link rel="apple-touch-icon" href="/media/files/apple-touch-icon-precomposed.png"><link rel="icon" type="image/png" href="/media/files/favicon-16x16.png" sizes="16x16"><link rel="icon" type="image/png" href="/media/files/favicon-32x32.png" sizes="32x32"><link rel="icon" type="image/png" href="/media/files/favicon-96x96.png" sizes="96x96"><link rel="icon" type="image/png" href="/media/files/favicon-160x160.png" sizes="160x160"><link rel="icon" type="image/png" href="/media/files/favicon-192x192.png" sizes="192x192"><link rel="icon" type="image/png" href="/media/files/favicon-196x196.png" sizes="196x196"><meta name="msapplication-TileImage" content="/media/files/win8-tile-144x144.png"><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-navbutton-color" content="#ffffff"><meta name="application-name" content="twoandahalfvan"><meta name="msapplication-tooltip" content="twoandahalfvan"><meta name="apple-mobile-web-app-title" content="twoandahalfvan"><meta name="msapplication-square70x70logo" content="/media/files/win8-tile-70x70.png"><meta name="msapplication-square144x144logo" content="/media/files/win8-tile-144x144.png"><meta name="msapplication-square150x150logo" content="/media/files/win8-tile-150x150.png"><meta name="msapplication-wide310x150logo" content="/media/files/win8-tile-310x150.png"><meta name="msapplication-square310x310logo" content="/media/files/win8-tile-310x310.png"><link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin><link href="https://fonts.googleapis.com/css?family=Ubuntu:400,700&amp;subset=latin-ext&amp;display=swap" rel="stylesheet"><style>h1,h2,h3,h4,h5,h6,.btn,[type=button],[type=submit],button,.navbar .navbar__menu li,.navbar_mobile_sidebar .navbar__menu li,.feed__author,.post__tag,.post__share>a span,.post__nav-link>span,.footer{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol"}body,h1,.h1,blockquote,.search__input,.author__name,.author__info>p,.feed__item h2,.post__nav-link{font-family:'Ubuntu',sans-serif}</style><link rel="stylesheet" href="https://twoandahalfvan.github.io/assets/css/style.css?v=d293323c6ba71fc5bcf1c7bc12bbe79a"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://twoandahalfvan.github.io/diy-lithium-battery/"},"headline":"DIY Lithium battery - Part I","datePublished":"2020-03-14T17:01","dateModified":"2020-03-30T18:55","image":{"@type":"ImageObject","url":"https://twoandahalfvan.github.io/media/posts/18/IMG_7628.JPG","height":3456,"width":5184},"description":"Building your own 12V Lithium battery can save you a couple of thousand € when compared to ready-to-buy Lithium batteries. However, it can be a daunting task if you have&hellip;","author":{"@type":"Person","name":"Dominik"},"publisher":{"@type":"Organization","name":"Judith","logo":{"@type":"ImageObject","url":"https://twoandahalfvan.github.io/media/website/logo-transparent-mit-rand-512px.png","height":512,"width":512}}}</script><script src="https://twoandahalfvan.github.io/assets/js/ls.parent-fit.min.js?v=1c78585e2a70398fe95085061942fd37"></script><script async src="https://twoandahalfvan.github.io/assets/js/lazysizes.min.js?v=149ff45fc6c2f13e892e438a58abb77f"></script><script>document.addEventListener("DOMContentLoaded", () => {
                if (!localStorage.getItem('publii-gdpr-allowed-cookies')){
                    document.getElementsByClassName('cookie-popup')[0].style.padding = '0 2rem 2rem 2rem';
                    let saveBtn = document.getElementsByClassName('cookie-popup__save')[0];
                    saveBtn.style.backgroundColor = '#ccc';
                    let saveAllBtn = document.createElement("BUTTON");
                    saveAllBtn.innerHTML = "Allow All";
                    saveAllBtn.onclick = (event) => {
                        let checkboxes = document.querySelectorAll('input[type=checkbox]');
                        checkboxes.forEach((cb) => {
                            cb.checked = true;
                        })
                        saveBtn.click();
                        document.getElementsByClassName('cookie-popup')[0].style.display = 'none';
                        let script = document.createElement('script');
                        script.src = 'https://www.googletagmanager.com/gtag/js?id=UA-161992053-1';
                        script.onload = () => {
                            window.dataLayer = window.dataLayer || [];
                            function gtag(){dataLayer.push(arguments);}
                            gtag('js', new Date());

                            gtag('config', 'UA-161992053-1');
                        }
                        document.head.append(script);
                        event.preventDefault();
                        return false;
                    };
                    document.getElementsByClassName('cookie-popup__save-wrapper')[0].insertBefore(saveAllBtn, saveBtn);
                }
            });</script><script type="gdpr-blocker/analytical" async src="https://www.googletagmanager.com/gtag/js?id=UA-161992053-1"></script><script type="gdpr-blocker/analytical" }>window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());

            gtag('config', 'UA-161992053-1');</script></head><body><div class="site-container"><header class="top" id="js-header"><a class="logo" href="https://twoandahalfvan.github.io/"><img src="https://twoandahalfvan.github.io/media/website/logo-transparent-mit-rand-512px.png" alt="twoandahalfvan"></a><nav class="navbar js-navbar"><button class="navbar__toggle js-toggle" aria-label="Menu" aria-haspopup="true" aria-expanded="false"><span class="navbar__toggle-box"><span class="navbar__toggle-inner">Menu</span></span></button><ul class="navbar__menu"><li class="has-submenu"><span class="is-separator" aria-haspopup="true">Our Van</span><ul class="navbar__submenu level-2" aria-hidden="true"><li><a href="https://twoandahalfvan.github.io/van-tour/" target="_self">Meet &quot;Gordito&quot;</a></li><li><a href="https://twoandahalfvan.github.io/our-layout/" target="_self">3D Model</a></li><li><a href="https://twoandahalfvan.github.io/solar-setup/" target="_self">Solar Setup</a></li><li><a href="https://twoandahalfvan.github.io/tag/shopping-list/" target="_self">Shopping List</a></li><li><a href="https://twoandahalfvan.github.io/faq/" target="_self">FAQ</a></li></ul></li><li class="active-parent has-submenu"><span class="is-separator" aria-haspopup="true">Van Build Tips</span><ul class="navbar__submenu level-2" aria-hidden="true"><li><a href="https://twoandahalfvan.github.io/choosing-the-right-van/" target="_self">Choosing the right van</a></li><li><a href="https://twoandahalfvan.github.io/planning-your-layout/" target="_self">Planning your layout</a></li><li><a href="https://twoandahalfvan.github.io/how-to-build-a-minimal-shower/" target="_self">Building a minimal shower</a></li><li class="active"><a href="https://twoandahalfvan.github.io/diy-lithium-battery/" target="_self">DIY Lithium Battery - Part I</a></li><li><a href="https://twoandahalfvan.github.io/how-to-secure-your-van/" target="_self">How to secure your van</a></li></ul></li><li><a href="https://twoandahalfvan.github.io/tag/vanlife/" target="_self">Vanlife</a></li><li class="has-submenu"><span class="is-separator" aria-haspopup="true">Travel Stories</span><ul class="navbar__submenu level-2" aria-hidden="true"><li><a href="https://twoandahalfvan.github.io/map-our-itinery/" target="_self">Map</a></li><li><a href="https://twoandahalfvan.github.io/tag/spain/" target="_self">Spain</a></li><li><a href="https://twoandahalfvan.github.io/timelapse-dashcam-movies/" target="_self">Dashcam videos</a></li></ul></li><li><a href="https://twoandahalfvan.github.io/about-us/" target="_self">About us</a></li></ul></nav><div class="search"><div class="search__overlay js-search-overlay"><div class="search__overlay-inner"><form action="https://twoandahalfvan.github.io/search.html" class="search__form"><input class="search__input js-search-input" type="search" name="q" placeholder="search..." autofocus="autofocus"></form><button class="search__close js-search-close" aria-label="Close">Close</button></div></div><button class="search__btn js-search-btn" aria-label="Search"><svg role="presentation" focusable="false"><use xlink:href="https://twoandahalfvan.github.io/assets/svg/svg-map.svg#search"/></svg></button></div></header><main><article class="post"><div class="hero"><figure class="hero__image"><img class="hero__image-img lazyload" data-src="https://twoandahalfvan.github.io/media/posts/18/IMG_7628.JPG" data-srcset="https://twoandahalfvan.github.io/media/posts/18/responsive/IMG_7628-xs.JPG 300w ,https://twoandahalfvan.github.io/media/posts/18/responsive/IMG_7628-sm.JPG 480w ,https://twoandahalfvan.github.io/media/posts/18/responsive/IMG_7628-md.JPG 768w ,https://twoandahalfvan.github.io/media/posts/18/responsive/IMG_7628-lg.JPG 1024w ,https://twoandahalfvan.github.io/media/posts/18/responsive/IMG_7628-xl.JPG 1360w ,https://twoandahalfvan.github.io/media/posts/18/responsive/IMG_7628-2xl.JPG 1600w" data-aspectratio="1.5" data-sizes="auto" alt="" height="3456" width="5184"></figure><header class="hero__content"><div class="wrapper"><h2>DIY Lithium battery - Part I</h2><div class="post__meta post__meta--author"><a href="https://twoandahalfvan.github.io/authors/dominik/" class="feed__author invert"><img class="lazyload post__author-thumb" data-src="https://twoandahalfvan.github.io/media/website/dom.jpg" alt="Dominik"> Dominik </a><span class="post__meta"><time datetime="2020-03-14T17:01">March 14, 2020</time></span></div></div></header></div><div class="wrapper post__entry"><p class="content">Building your own 12V Lithium battery can save you a couple of thousand € when compared to ready-to-buy Lithium batteries. However, it can be a daunting task if you have never done it before. In this post we will describe some basics you need to know before you can build your own 12V Lithium battery.</p><div class="content"><p class="msg msg--warning"><span class="warning-header">WARNING</span><br>Building a 12V battery requires knowledge about basic electricity rules and security measures when handling electricity.<br>If you are unsure if you meet these requirements, please buy a ready-to-use battery or consult a qualified electrician.</p><p> </p><div class="post__iframe"><iframe class="lazyload" width="580" height="326" data-src="https://3dwarehouse.sketchup.com/embed/16bf9dab-7cc0-42db-a042-a9535bba4d33" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" allowfullscreen="allowfullscreen"></iframe></div><p>Let's start with some basic terminology:</p><ul><li>BMS - Battery Management System</li><li>SoC - State of Charge</li><li>OVP - Over Voltage Protection</li><li>UVP - Under Voltage Protection</li><li>LVP - Low Voltage Protection</li><li>Cells</li><li>Balancers</li><li>Relays</li><li>Hystersis</li></ul><h3>BMS and SoC</h3><p>Lets start with the <strong>BMS</strong>. The task of a BMS is to protect a battery and to make sure that it operates within the specifications of the battery cell manufacturer. While you can operate some kind of batteries without a BMS, you should never operate a Lithium battery without a BMS. A BMS can also contain some additional features, such as a <strong>State of Charge</strong> detection ("how much juice is left?"), but its core function is to protect the battery from unwanted conditions, such as OVP and UVP and unsupported temperatures.</p><p>Lithium batteries operate within a voltage range. A Lithium battery with a nominal voltage of 12V has an actual voltage of approximately 14,4V when fully charged and about 11V when it is empty. Now, these values are not static or fixed, some people like to charge their Lithium batteries up to 14,6V. This is often a topic of debate, because Lithium batteries tend to have a longer lifespan (measured in charge cycles) when they are not constantly fully charged or fully emptied. In fact, Lithium batteries have a significantly longer life expectation when they are operated around the 50% SoC.</p><h2>On the matter of voltage</h2><p>Most 12V appliances can operate within the voltage range that a 12V nominal voltage battery provides. However, some 12V appliances may not work correctly when the system voltage is too low or too high, in which case you could add DC-DC converter, which will regulate the system voltage to constant 12V at the expense of a certain efficiency rate (such as 96%).</p><p>When you buy a charger for your battery, you must ensure that it is compatible with your battery in terms of the type of chemistry and system voltage. You should never use a lead acid battery charger on a lithium battery and vice versa, because these chargers have different cutoff voltages and charging methods or algorithms. A charging method or algorithm determines how a battery is charged over time.</p><p>In order to protect the Lithium battery cells from being over charged, we need <strong>Over Voltage Protection</strong> (OVP). Similarly, we need <strong>Under Voltage Protection</strong> (UVP), sometimes also referred to as Low Voltage Protection (LVP) to protect the cells from being discharged beyond it's specifications. If you charge or discharge your battery without OVP and UVP, you can permanently damage the cells, which may cause them to be unusable.</p><h2>Battery cells - the building blocks of your battery</h2><p>Now, every battery is made up of individual <strong>cells</strong> that are usually wired together in series. In the case of a 12V LiFePo4 battery, each of the four cells that are necessary to create a working battery may have a voltage of 3,6V when the complete battery is fully charged (4 cells * 3,6V = 14,4V). However, in reality, these cells are likely not to have the same voltage. They are more likely to diverge slightly, as their chemical properties may differ slightly and change over time. Here is an example of what your cells voltage might look like if it is 100% charged.</p><table><thead><tr><th>Cell</th><th>Voltage</th></tr></thead><tbody><tr><td>1</td><td>3,59</td></tr><tr><td>2</td><td>3,60</td></tr><tr><td>3</td><td>3,61</td></tr><tr><td>4</td><td>3,60</td></tr></tbody></table><p>Because every cell has slightly different chemical characteristics, some cells may be fully charged before other cells. In order to still reach the 14,4V, the charger keeps charging. If the fully charged cell continues to charge, it would be overcharged and thus damaged. It is the task of so called <strong>cell balancers</strong> to make sure that individual cells are charged equally. These balancers are typically electric components that are mounted directly on top of the individual cell terminals. Balancing can be done by actively routing the charging current to the cells that needs it ("active balancing") or by simply converting the superfluous charging current to heat by means of a simple resistor (which may require a heat dissipation device, such as a fan or heat sink).</p><h2>Relays and Hysteresis</h2><p>Cell balancers may also measure the voltage of the cell they are mounted to and signal an over voltage or under voltage to an upstream device called "<strong>relay</strong>". You can think of a relay as a remotely controlled switch, that switches an electrical connection based on the information it gets. For instance, if one cell balancer singals an under voltage situation to the relay input of a 230V inverter, the inverter may switch it's electrical connection to the battery off. Relays exist in various form factors.</p><p>Last but not least, a <strong>hysteresis</strong> function helps to detect temporary low or high voltage situations. For instance, a coffee machine has a very high electrical demand when it brews, causing a high dip in system voltage for a very short amount of time. In it's simplest form, a hysteresis function requires a certain amount of time to pass before it signals under voltage. Some systems have multiple OVP or LVP functions, allowing for instance a voltage level of 11,2V to exist for 30 seconds, but cutting off directly at 11V.</p></div></div></article><div class="post__related related"><center><h3>Related Articles</h3></center><div class="posts"><a href="https://twoandahalfvan.github.io/choosing-the-right-van/" class="post"><article><header class="wrapper"><h3>Choosing the right van</h3></header><div class="feed__image"><img class="lazyload" data-src="https://twoandahalfvan.github.io/media/posts/17/facelifted-citroen-jumper-breaks-cover-video-photo-gallery_9.png" data-srcset="https://twoandahalfvan.github.io/media/posts/17/responsive/facelifted-citroen-jumper-breaks-cover-video-photo-gallery_9-xs.png 300w ,https://twoandahalfvan.github.io/media/posts/17/responsive/facelifted-citroen-jumper-breaks-cover-video-photo-gallery_9-sm.png 480w ,https://twoandahalfvan.github.io/media/posts/17/responsive/facelifted-citroen-jumper-breaks-cover-video-photo-gallery_9-md.png 768w ,https://twoandahalfvan.github.io/media/posts/17/responsive/facelifted-citroen-jumper-breaks-cover-video-photo-gallery_9-lg.png 1024w ,https://twoandahalfvan.github.io/media/posts/17/responsive/facelifted-citroen-jumper-breaks-cover-video-photo-gallery_9-xl.png 1360w ,https://twoandahalfvan.github.io/media/posts/17/responsive/facelifted-citroen-jumper-breaks-cover-video-photo-gallery_9-2xl.png 1600w" data-aspectratio="1.4988290398126465" data-sizes="auto" height="854" width="1280" alt="Choosing the right van"></div><div class="feed__item__excerpt"><p>Choosing the right van is a crucial step when planning to build your own mobile home. This post will give you an overview of what's available in the EU market.</p></div></article></a><a href="https://twoandahalfvan.github.io/planning-your-layout/" class="post"><article><header class="wrapper"><h3>Planning your layout</h3></header><div class="feed__image"><img class="lazyload" data-src="https://twoandahalfvan.github.io/media/posts/4/Jumper-FINAL-FINAL-for-EXPORT.png" data-srcset="https://twoandahalfvan.github.io/media/posts/4/responsive/Jumper-FINAL-FINAL-for-EXPORT-xs.png 300w ,https://twoandahalfvan.github.io/media/posts/4/responsive/Jumper-FINAL-FINAL-for-EXPORT-sm.png 480w ,https://twoandahalfvan.github.io/media/posts/4/responsive/Jumper-FINAL-FINAL-for-EXPORT-md.png 768w ,https://twoandahalfvan.github.io/media/posts/4/responsive/Jumper-FINAL-FINAL-for-EXPORT-lg.png 1024w ,https://twoandahalfvan.github.io/media/posts/4/responsive/Jumper-FINAL-FINAL-for-EXPORT-xl.png 1360w ,https://twoandahalfvan.github.io/media/posts/4/responsive/Jumper-FINAL-FINAL-for-EXPORT-2xl.png 1600w" data-aspectratio="2.0719424460431655" data-sizes="auto" height="1390" width="2880" alt=""></div><div class="feed__item__excerpt"><p>Planning is an important step when converting a van to a livable home. Many people skimp on this. It's easier than you might think and the benefits are real. You don't&hellip;</p></div></article></a></div></div></main><footer class="footer"><div class="footer__social"><a href="https://www.instagram.com/twoandahalfvan/" aria-label="Instagram"><svg><use xlink:href="https://twoandahalfvan.github.io/assets/svg/svg-map.svg#instagram"/></svg> </a><a href="https://www.pinterest.de/twoandahalfvan/" aria-label="Pinterest"><svg><use xlink:href="https://twoandahalfvan.github.io/assets/svg/svg-map.svg#pinterest"/></svg> </a><a href="https://www.youtube.com/twoandahalfvan/" aria-label="Youtube"><svg><use xlink:href="https://twoandahalfvan.github.io/assets/svg/svg-map.svg#youtube"/></svg></a></div><div class="footer__copyright"><p>© twoandahalfvan 2020</p><p><a href="../../../../../legal-notice">Legal Notice</a> - <a href="../../../../../privacy-policy">Privacy Policy</a></p></div><button class="footer__bttop js-footer__bttop" aria-label="Back to top"><svg><title>Back to top</title><use xlink:href="https://twoandahalfvan.github.io/assets/svg/svg-map.svg#toparrow"/></svg></button></footer></div><script>window.publiiThemeMenuConfig = {    
        mobileMenuMode: 'sidebar',
        animationSpeed: 300,
        submenuWidth: 'auto',
        doubleClickTime: 500,
        mobileMenuExpandableSubmenus: true, 
        relatedContainerForOverlayMenuSelector: '.top',
   };</script><script defer="defer" src="https://twoandahalfvan.github.io/assets/js/scripts.min.js?v=f56b13ba141d95ea2a0b7aab75ca9528"></script><script>var lazyFeaturedImage=function lazyFeaturedImage(){var b=document.querySelectorAll(".hero__image-img");for(var a=0;a<b.length;a++){var c=b[a];c.addEventListener("lazyloaded",function(f){var d=f.target.parentNode;d.classList.add("hero__image--overlay")})}};lazyFeaturedImage();</script><div class="cookie-popup js-cookie-popup cookie-popup--uses-badge"><h2>This website uses cookies</h2><p>This website uses cookies for certain functionality. <a href="https://twoandahalfvan.github.io/privacy-policy/">Privacy Policy</a></p><form><input id="gdpr-necessary" name="gdpr-necessary" checked="checked" disabled="disabled" type="checkbox"> <label for="gdpr-necessary">Necessary</label> <input id="gdpr-analytical" name="gdpr-analytical" type="checkbox"> <label for="gdpr-analytical">Analytical</label><p class="cookie-popup__save-wrapper"><button type="submit" class="cookie-popup__save">Allow Selected</button></p></form><span class="cookie-popup-label">Cookie Policy</span></div><script>(function() {
                function addScript (src, inline) {
                    var newScript = document.createElement('script');

                    if (src) {
                        newScript.setAttribute('src', src);
                    }

                    if (inline) {
                        newScript.text = inline;
                    }

                    document.body.appendChild(newScript);
                }

                var popup = document.querySelector('.js-cookie-popup');
                var checkboxes = popup.querySelectorAll('input[type="checkbox"]');
                var save = popup.querySelector('button');
                var currentConfig = localStorage.getItem('publii-gdpr-allowed-cookies');
                var blockedScripts = document.querySelectorAll('script[type^="gdpr-blocker/"]');
                

                popup.addEventListener('click', function() {
                    if (!popup.classList.contains('cookie-popup--is-sticky')) {
                        popup.classList.add('cookie-popup--is-sticky');
                    }
                });

                save.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    popup.classList.remove('cookie-popup--is-sticky');
                    var allowedGroups = [];

                    for (var i = 0; i < checkboxes.length; i++) {
                        if (checkboxes[i].checked) {
                            var groupName = checkboxes[i].getAttribute('name').replace('gdpr-', '');
                            var scripts = document.querySelectorAll('script[type="gdpr-blocker/' + groupName + '"]');

                            for (var j = 0; j < scripts.length; j++) {
                                addScript(scripts[j].src, scripts[j].text);
                            }

                            allowedGroups.push(groupName);
                        }
                    }

                    localStorage.setItem('publii-gdpr-allowed-cookies', allowedGroups.join(','));
                    popup.classList.remove('cookie-popup--is-sticky');

                    setTimeout(function () {
                        if (currentConfig !== null) {
                            window.location.reload();
                        }
                    }, 250);
                });

                if (currentConfig === null) {
                    popup.classList.add('cookie-popup--is-sticky');
                } else {
                    if (currentConfig !== '') {
                        var allowedGroups = currentConfig.split(',');

                        for (var i = 0; i < allowedGroups.length; i++) {
                            var scripts = document.querySelectorAll('script[type="gdpr-blocker/' + allowedGroups[i] + '"]');
                            var checkbox = popup.querySelector('input[type="checkbox"][name="gdpr-' + allowedGroups[i] + '"]');

                            if (checkbox) {
                                checkbox.checked = true;
                            }

                            for (var j = 0; j < scripts.length; j++) {
                                addScript(scripts[j].src, scripts[j].text);
                            }
                        }
                    }
                }
            })();</script></body></html>